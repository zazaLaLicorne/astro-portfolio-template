---
import ThemeToggle from "./ThemeToggle.astro";
const isHome = Astro.url.pathname === "/";
---

<header
  class="fixed top-0 left-0 right-0 z-50 bg-bg backdrop-blur-md shadow-md transition-colors duration-300"
>
  <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex items-center justify-between h-16">
      <!-- Logo -->

      <div class="flex-shrink-0">
        <a
          href="/"
          aria-label="home"
          class="flex items-center transition-colors"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            height="32px"
            viewBox="0 -960 960 960"
            width="32px"
            fill="currentColor"
          >
            <path
              d="M226.67-186.67h140v-246.66h226.66v246.66h140v-380L480-756.67l-253.33 190v380ZM160-120v-480l320-240 320 240v480H526.67v-246.67h-93.34V-120H160Zm320-352Z"
            ></path>
          </svg>
        </a>
      </div>

      <!-- Navigation Desktop -->
      {
        isHome && (
          <ul class="hidden md:flex items-center space-x-8">
            <li>
              <a href="#about" class="font-medium transition-colors">
                Qui suis-je?
              </a>
            </li>
             <li>
              <a href="#services" class="font-medium transition-colors">
                Mes services
              </a>
            </li>
            <li>
              <a href="#certifications" class="font-medium transition-colors">
                Certifications
              </a>
            </li>
            <li>
              <a href="#technos" class="font-medium transition-colors">
                Technos
              </a>
            </li>
            <li>
              <a href="#realisations" class="font-medium transition-colors">
                Réalisations
              </a>
            </li>
            <li>
              <a href="#reviews" class="font-medium transition-colors">
                Avis
              </a>
            </li>
            <li>
              <a href="#contact" class="font-medium transition-colors">
                Contacts
              </a>
            </li>
            <li>
              <a
                href="/CV.pdf"
                target="_blank"
                rel="noopener noreferrer"
                class="font-medium transition-colors"
              >
                Voir le CV
              </a>
            </li>
          </ul>
        )
      }
      <!-- Theme Toggle -->
      <div>
        <ThemeToggle />
      </div>

      <!-- Burger Menu Mobile -->
      {
        isHome && (
          <button
            id="mobile-menu-button"
            class="md:hidden p-2 rounded-lg transition-colors font-semibold "
            aria-label="Menu"
            aria-controls="mobile-menu"
            aria-expanded="false"
            type="button"
          >
            <svg
              class="w-6 h-6 transition-colors duration-200 focus-visible:text-neon"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M4 6h16M4 12h16M4 18h16"
              />
            </svg>
          </button>
        )
      }
    </div>

    <!-- Menu Mobile (hors flux, sous le header) -->
    {
      isHome && (
        <div
          id="mobile-menu"
          data-open="false"
          class="md:hidden absolute left-0 right-0 top-full mt-2 mx-4 rounded-lg
        bg-bg backdrop-blur-md shadow-lg
         overflow-hidden
         origin-top
         transition-[max-height,opacity,transform] duration-250 ease-out
         max-h-0 opacity-0 -translate-y-2
         pointer-events-none"
        >
          <ul class="py-3 space-y-1 text-center">
            <li>
              <a
                href="#about"
                class="block px-4 py-2 rounded-lg transition-colors"
              >
                Qui suis-je?
              </a>
            </li>
            <li>
              <a href="#services" class="block px-4 py-2 rounded-lg transition-colors">
                Mes services
              </a>
            </li>
            <li>
              <a
                href="#certifications"
                class="block px-4 py-2 rounded-lg transition-colors"
              >
                Certifications
              </a>
            </li>
            <li>
              <a
                href="#technos"
                class="block px-4 py-2 rounded-lg transition-colors"
              >
                Technos
              </a>
            </li>
            <li>
              <a
                href="#realisations"
                class="block px-4 py-2 rounded-lg transition-colors"
              >
                Réalisations
              </a>
            </li>
            <li>
              <a
                href="#reviews"
                class="block px-4 py-2 rounded-lg transition-colors"
              >
                Avis
              </a>
            </li>
            <li>
              <a
                href="#contact"
                class="block px-4 py-2 rounded-lg transition-colors"
              >
                Contacts
              </a>
            </li>
            <li>
              <a
                href="/CV.pdf"
                target="_blank"
                rel="noopener noreferrer"
                class="block px-4 py-2 rounded-lg transition-colors"
              >
                Voir le CV
              </a>
            </li>
          </ul>
        </div>
      )
    }
  </nav>
</header>

<script>
  const mobileMenuButton = document.getElementById("mobile-menu-button");
  const mobileMenu = document.getElementById("mobile-menu");

  function setMenuOpen(open) {
    if (!mobileMenu || !mobileMenuButton) return;

    mobileMenu.dataset.open = open ? "true" : "false";
    mobileMenuButton.setAttribute("aria-expanded", String(open));
  }

  mobileMenuButton?.addEventListener("click", () => {
    const isOpen = mobileMenu?.dataset.open === "true";
    setMenuOpen(!isOpen);
  });

  // Ferme le menu au clic sur un lien
  mobileMenu?.querySelectorAll("a")?.forEach((link) => {
    link.addEventListener("click", () => setMenuOpen(false));
  });

  // Optionnel: fermer au clic en dehors
  document.addEventListener("click", (e) => {
    if (!mobileMenu || !mobileMenuButton) return;
    const target = e.target;
    if (!(target instanceof Node)) return;

    const clickedInsideMenu = mobileMenu.contains(target);
    const clickedButton = mobileMenuButton.contains(target);

    if (!clickedInsideMenu && !clickedButton) setMenuOpen(false);
  });

  // Optionnel: fermer avec Escape
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") setMenuOpen(false);
  });
</script>

<style>
  #mobile-menu[data-open="true"] {
    max-height: 24rem; /* ~ max-h-96 */
    opacity: 1;
    transform: translateY(0);
    pointer-events: auto;
  }
  #mobile-menu[data-open="false"] {
    max-height: 0;
    opacity: 0;
    transform: translateY(-0.5rem);
    pointer-events: none;
  }
</style>
